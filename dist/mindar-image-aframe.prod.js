(()=>{var t={2792:function(t){t.exports=function(){"use strict";var t=function(){var e=0,i=document.createElement("div");function n(t){return i.appendChild(t.dom),t}function a(t){for(var n=0;n<i.children.length;n++)i.children[n].style.display=n===t?"block":"none";e=t}i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),a(++e%i.children.length)}),!1);var s=(performance||Date).now(),r=s,o=0,l=n(new t.Panel("FPS","#0ff","#002")),h=n(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new t.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:i,addPanel:n,showPanel:a,begin:function(){s=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(h.update(t-s,200),r+1e3<=t&&(l.update(1e3*o/(t-r),100),r=t,o=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:i,setMode:a}};return t.Panel=function(t,e,i){var n=1/0,a=0,s=Math.round,r=s(window.devicePixelRatio||1),o=80*r,l=48*r,h=3*r,c=2*r,d=3*r,u=15*r,m=74*r,p=30*r,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*r+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,o,l),g.fillStyle=e,g.fillText(t,h,c),g.fillRect(d,u,m,p),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d,u,m,p),{dom:f,update:function(l,v){n=Math.min(n,l),a=Math.max(a,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,o,u),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(a)+")",h,c),g.drawImage(f,d+r,u,m-r,p,d,u,m-r,p),g.fillRect(d+m-r,u,r,p),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(d+m-r,u,r,s((1-l/v)*p))}}},t}()}},e={};function i(n){var a=e[n];if(void 0!==a)return a.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,i),s.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t="arError",e="image-markerFound",n="image-markerLost",a="mindar-image-system";AFRAME.registerComponent("mindar-image",{dependencies:[a],el:null,schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"},reshowScanning:{type:"boolean",default:!0},shouldFaceUser:{type:"boolean",default:!1}},init:function(){const t=this.el.sceneEl.systems["mindar-image-system"];t.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:-1===this.data.filterMinCF?null:this.data.filterMinCF,filterBeta:-1===this.data.filterBeta?null:this.data.filterBeta,missTolerance:-1===this.data.missTolerance?null:this.data.missTolerance,warmupTolerance:-1===this.data.warmupTolerance?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError,reshowScanning:this.data.reshowScanning,shouldFaceUser:this.data.shouldFaceUser}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",(()=>{t.start()}))}}),AFRAME.registerComponent("mindar-image-target",{dependencies:[a],el:null,postMatrix:null,schema:{targetIndex:{type:"number"}},init:function(){this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex);const t=this.el.object3D;t.visible=!1,t.matrixAutoUpdate=!1},setupMarker([t,e]){const i=new AFRAME.THREE.Vector3,n=new AFRAME.THREE.Quaternion,a=new AFRAME.THREE.Vector3;i.x=t/2,i.y=t/2+(e-t)/2,a.x=t,a.y=t,a.z=t,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(i,n,a)},updateWorldMatrix(t){if(!this.el.object3D.visible&&t?this.el.emit(e):this.el.object3D.visible&&!t&&this.el.emit(n),this.el.object3D.visible=!!t,!t)return;const i=new AFRAME.THREE.Matrix4;i.elements=t,i.multiply(this.postMatrix),this.el.object3D.matrix=i}});var s=i(2792),r=i.n(s);const{Controller:o,UI:l}=window.MINDAR.IMAGE;AFRAME.registerSystem(a,{container:null,video:null,anchorEntities:[],imageTargetSrc:"",maxTrack:-1,filterMinCF:-1/0,filterBeta:1/0,missTolerance:-1/0,warmupTolerance:-1/0,showStats:!1,controller:null,ui:null,el:null,mainStats:null,reshowScanning:!0,shouldFaceUser:!1,init:function(){this.anchorEntities=[]},setup:function({imageTargetSrc:t,maxTrack:e,showStats:i,uiLoading:n,uiScanning:a,uiError:s,missTolerance:r,warmupTolerance:o,filterMinCF:h,filterBeta:c,reshowScanning:d,shouldFaceUser:u}){this.imageTargetSrc=t,this.maxTrack=e,this.filterMinCF=h,this.filterBeta=c,this.missTolerance=r,this.warmupTolerance=o,this.showStats=i,this.reshowScanning=d,this.shouldFaceUser=u,this.ui=new l({uiLoading:n,uiScanning:a,uiError:s}),this._registerEventListener()},_registerEventListener:function(){this.el.addEventListener(e,(()=>{this.ui.hideScanning()})),this.el.addEventListener(n,(()=>{this.reshowScanning&&this.ui.showScanning()}))},registerAnchor:function(t,e){this.anchorEntities.push({el:t,targetIndex:e})},start:function(){this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new(r()),this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position: absolute; top: 0px; left: 0px; z-index: 999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo()},switchTarget:function(t){this.controller.interestedTargetIndex=t},stop:function(){if(this.pause(),!this.video)return;const{srcObject:t}=this.video;t&&(t.getTracks().forEach((function(t){t.stop()})),this.video.remove())},switchCamera:function(){this.shouldFaceUser=!this.shouldFaceUser,this.stop(),this.start()},pause:function(t=!1){t||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:async function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return this.el.emit(t,{error:"VIDEO_FAIL"}),void this.ui.showCompatibility();try{const t=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind));let e="environment";t.length>1&&(e=this.shouldFaceUser?"user":"environment");const i=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:e}});this.video.addEventListener("loadedmetadata",(()=>{this.video.setAttribute("width",this.video.videoWidth.toString()),this.video.setAttribute("height",this.video.videoHeight.toString()),this._startAR()})),this.video.srcObject=i}catch(e){console.log("getUserMedia error",e),this.el.emit(t,{error:"VIDEO_FAIL"})}},_startAR:async function(){this.controller=new o({inputWidth:this.video.videoWidth,inputHeight:this.video.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:t=>{switch(t.type){case"processDone":this.mainStats&&this.mainStats.update();break;case"updateMatrix":const{targetIndex:e,worldMatrix:i}=t;for(const t of this.anchorEntities)t.targetIndex===e&&t.el.updateWorldMatrix(i)}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));const{dimensions:t}=await this.controller.addImageTargets(this.imageTargetSrc);for(const e of this.anchorEntities){const{el:i,targetIndex:n}=e;n<t.length&&i.setupMarker(t[n])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){const{vh:t}=((t,e)=>{let i,n;const a=t.videoWidth/t.videoHeight;return a>e.clientWidth/e.clientHeight?(n=e.clientHeight,i=n*a):(i=e.clientWidth,n=i/a),t.style.top=-(n-e.clientHeight)/2+"px",t.style.left=-(i-e.clientWidth)/2+"px",t.style.width=i+"px",t.style.height=n+"px",{vw:i,vh:n}})(this.video,this.container),e=this.container,i=this.controller.getProjectionMatrix(),n=2*Math.atan(1/i[5]/t*e.clientHeight)*180/Math.PI,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),r=e.clientWidth/e.clientHeight,o=e.getElementsByTagName("a-camera")[0].getObject3D("camera");o.fov=n,o.aspect=r,o.near=a,o.far=s,o.updateProjectionMatrix()}})})()})();